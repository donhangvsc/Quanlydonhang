<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá th·ªëng POS Online - L∆∞u Google Sheets</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.0/lucide.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-slate-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [items, setItems] = useState([]);
            const [form, setForm] = useState({ name: '', qty: 1, price: '' });
            const [customer, setCustomer] = useState('Kh√°ch l·∫ª');
            const [sheetUrl, setSheetUrl] = useState(localStorage.getItem('gsheet_url') || '');
            const [isSaving, setIsSaving] = useState(false);

            // L∆∞u URL v√†o localStorage ƒë·ªÉ kh√¥ng ph·∫£i nh·∫≠p l·∫°i
            useEffect(() => {
                localStorage.setItem('gsheet_url', sheetUrl);
            }, [sheetUrl]);

            const addItem = () => {
                if (!form.name || !form.price) return;
                const newItem = {
                    id: Date.now(),
                    ...form,
                    qty: Number(form.qty),
                    price: Number(form.price)
                };
                setItems([newItem, ...items]);
                setForm({ name: '', qty: 1, price: '' });
            };

            const removeItem = (id) => {
                setItems(items.filter(item => item.id !== id));
            };

            const totalAmount = items.reduce((sum, i) => sum + (i.qty * i.price), 0);

            const saveToSheets = async () => {
                if (!sheetUrl) {
                    alert("Vui l√≤ng nh·∫≠p URL Google Apps Script!");
                    return;
                }
                setIsSaving(true);
                try {
                    await fetch(sheetUrl, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            customer,
                            items: items.map(i => ({ name: i.name, qty: i.qty, price: i.price }))
                        })
                    });
                    alert("ƒê√£ g·ª≠i d·ªØ li·ªáu th√†nh c√¥ng!");
                } catch (err) {
                    alert("L·ªói k·∫øt n·ªëi!");
                } finally {
                    setIsSaving(false);
                }
            };

            return (
                <div className="min-h-screen flex justify-center pb-40">
                    <div className="w-full max-w-md bg-white shadow-2xl flex flex-col min-h-screen">
                        
                        {/* Header */}
                        <div className="bg-indigo-700 p-6 text-white shadow-lg">
                            <h1 className="text-xl font-extrabold tracking-tight">H·ªÜ TH·ªêNG POS ONLINE</h1>
                            <p className="text-[10px] opacity-70 mt-1 uppercase font-semibold tracking-widest">ƒê·ªìng b·ªô Google Drive</p>
                        </div>

                        {/* Config */}
                        <div className="p-4 bg-indigo-50 border-b border-indigo-100 space-y-3">
                            <div>
                                <label className="text-[10px] font-bold text-indigo-400 uppercase">Google Apps Script URL</label>
                                <input 
                                    className="w-full mt-1 p-2 text-[10px] border border-indigo-200 rounded-lg outline-none focus:ring-2 focus:ring-indigo-500"
                                    placeholder="D√°n URL Web App t·ª´ Google Sheets..."
                                    value={sheetUrl}
                                    onChange={(e) => setSheetUrl(e.target.value)}
                                />
                            </div>
                            <div>
                                <label className="text-[10px] font-bold text-indigo-400 uppercase">T√™n kh√°ch h√†ng</label>
                                <input 
                                    className="w-full mt-1 p-3 bg-white border border-indigo-200 rounded-xl font-bold text-sm"
                                    value={customer}
                                    onChange={(e) => setCustomer(e.target.value)}
                                />
                            </div>
                        </div>

                        {/* Input Form */}
                        <div className="p-4 space-y-3">
                            <input 
                                placeholder="T√™n h√†ng h√≥a..." 
                                className="w-full p-4 bg-slate-50 rounded-2xl border-none shadow-inner text-sm outline-none"
                                value={form.name}
                                onChange={(e) => setForm({...form, name: e.target.value})}
                            />
                            <div className="flex gap-2">
                                <input 
                                    type="number" placeholder="SL" 
                                    className="w-1/4 p-4 bg-slate-50 rounded-2xl border-none shadow-inner text-sm text-center font-bold"
                                    value={form.qty}
                                    onChange={(e) => setForm({...form, qty: e.target.value})}
                                />
                                <input 
                                    type="number" placeholder="ƒê∆°n gi√°" 
                                    className="w-3/4 p-4 bg-slate-50 rounded-2xl border-none shadow-inner text-sm font-bold text-indigo-700"
                                    value={form.price}
                                    onChange={(e) => setForm({...form, price: e.target.value})}
                                />
                            </div>
                            <button 
                                onClick={addItem}
                                className="w-full bg-indigo-600 text-white font-bold py-4 rounded-2xl shadow-lg active:scale-95 transition-all text-xs uppercase"
                            >
                                Th√™m v√†o ƒë∆°n h√†ng
                            </button>
                        </div>

                        {/* List Area */}
                        <div className="p-4 flex-1 overflow-y-auto">
                            {items.length === 0 ? (
                                <div className="py-10 text-center text-slate-300 italic text-sm">Danh s√°ch tr·ªëng</div>
                            ) : (
                                <div className="space-y-3">
                                    {items.map(item => (
                                        <div key={item.id} className="flex justify-between items-center p-4 bg-white border border-slate-100 rounded-2xl shadow-sm">
                                            <div>
                                                <h4 className="font-bold text-slate-800 text-sm">{item.name}</h4>
                                                <p className="text-[10px] text-slate-400">{item.qty} x {item.price.toLocaleString()}ƒë</p>
                                            </div>
                                            <div className="flex items-center gap-4">
                                                <span className="font-bold text-indigo-600">{(item.qty * item.price).toLocaleString()}ƒë</span>
                                                <button onClick={() => removeItem(item.id)} className="text-red-300 hover:text-red-500">
                                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>

                        {/* Footer Actions */}
                        <div className="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t p-5 shadow-[0_-10px_30px_rgba(0,0,0,0.1)] z-50">
                            <div className="flex justify-between items-center mb-5 px-1">
                                <span className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">T·ªïng c·ªông</span>
                                <span className="text-2xl font-black text-indigo-700">{totalAmount.toLocaleString()}ƒë</span>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <button 
                                    onClick={saveToSheets}
                                    disabled={isSaving || items.length === 0}
                                    className="flex flex-col items-center justify-center bg-emerald-600 py-4 rounded-3xl text-[10px] font-bold uppercase text-white shadow-xl active:scale-95 transition-all disabled:opacity-50"
                                >
                                    <span className="mb-1 text-lg">üìä</span> {isSaving ? 'ƒêang l∆∞u...' : 'L∆∞u Google Sheets'}
                                </button>
                                <button className="flex flex-col items-center justify-center bg-blue-600 py-4 rounded-3xl text-[10px] font-bold uppercase text-white shadow-xl active:scale-95 transition-all">
                                    <span className="mb-1 text-lg">üí¨</span> G·ª≠i Zalo
                                </button>
                            </div>
                        </div>

                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        
        // Initialize icons
        setTimeout(() => lucide.createIcons(), 500);
    </script>
</body>
</html>

